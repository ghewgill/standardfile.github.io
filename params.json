{
  "name": "Standard Notes Protocol",
  "tagline": "",
  "body": "OpenNotes Specification\r\n\r\nVersion 0.10.0\r\n\r\n## Preamble\r\nNotes are an essential part of human life, a tradition dating back tens of thousands of years. A person a thousand years ago may not have had much: a home, some food, family, and quite often, a journal. These thoughts, scribbled down on paper, belonged to no one but the authors themselves.\r\n\r\nToday, our notes are owned by Evernote Incorporated; by Google Incorporated; by Apple Inc. We do not own our own notes. They are owned by for-profit corporations, who are today at the mercy of paranoid governments looking to extend their reach as far as possible.\r\n\r\nThese platforms also typically lock you in, so that it's either difficult or inconvenient to transfer to another service.\r\n\r\nOpenNotes is an open specification for a simple and secure system of organizing notes and groups of notes, and also publishing groups and notes onto the internet. Because it is an open protocol, a user need not be locked in to any application. Indeed, a user may even use multiple applications on different platforms to manage the same dataset.\r\n\r\n## Introduction\r\nThis document outlines the specifications for the client-server communications of the OpenNotes system. Any client can communicate with an OpenNotes server as long as it understands the server's requirements.\r\n\r\n### Models\r\n\r\nThe protocol consists of four main models:\r\n\r\n- User\r\n- Notes\r\n- Groups\r\n- Presentations\r\n\r\n#### User\r\nA user model has the following properties:\r\n\r\n| name | type | description |\r\n|---|---|\r\n| email | Integer | The email of the user. | \r\n| password | String | The password for this user. *Clients must enforce a 24 character minimum for passwords.* | \r\n| username (*optional*) | String | A unique username used for presentations. For servers that manage multiple Users, the username serves as a way to namespace presentations.| \r\n\r\n#### Notes\r\n\r\nNote models have the following properties:\r\n\r\n| name | type | description |\r\n|---|---|\r\n| id | Integer | The id for this note. These ids are relative to the server hosting the data, and may change if a user initiated export and import occurs. | \r\n| uuid | String | The unique global identifier for this note. This uuid does not change during new data imports. | \r\n| content | Text | The JSON string encoded content of the note.| \r\n| loc_eek | String | The locally encrypted encryption key for this note. | \r\n| group_id (*optional*) | Integer | The identifier of the group this note belongs to. | \r\n| created_at | Date | The date this note was created. | \r\n| modified_at | Date | The date this note was modified. | \r\n\r\nDefinitions:\r\n\r\n**content**: The content of a note is a JSON encoded string with the following format: \r\n\r\n```\r\n{title: _note_title_, text: _note_text_}\r\n```\r\n\r\n#### Groups\r\nGroup models have the following properties:\r\n\r\n| name | type | description |\r\n|---|---|\r\n| id | Integer | The id for this group. | \r\n| uuid | String | The unique global identifier for this group. This uuid does not change during new data imports. | \r\n| name | String | The name of the group. | \r\n| created_at | Date | The date this group was created. | \r\n| modified_at | Date | The date this group was modified. | \r\n\r\n#### Presentations\r\nPresentations are how groups and notes are presented to the public. Groups and notes are by default unpresented and hidden from public view. However, a user may choose to make a group or a note publicly viewable.\r\n\r\nA group or a note with a presentation can be accessed by the presentation's `url`, which the server computes and returns with the presentation payload.\r\n\r\nNotes with a presentation are stored on the server without client-side encryption.\r\n\r\n| name | type | description |\r\n|---|---|\r\n| id | Integer | The id for this presentation. | \r\n| uuid | String | The unique global identifier for this presentation. This uuid does not change during new data imports. | \r\n| root_path (*read-only*)| String | The root path of this presentation, as decided by the server. |\r\n| relative_path | String | The relative location of this presentation, with respect to the root_path. This path can be chosen by the client user.|\r\n| url (*read-only*)| String | The full URL of this presentation. The server decides what this URL is, and should be based off the root and relative path.|\r\n| presentable_type | String | The class of the object being presented. This can be set to \"Note\" or \"Group\". | \r\n| presentable_id | String | The identifier of the object being presented. This will be the identifier of the Note or Group being presented. | \r\n| created_at | Date | The date this presentation was created. | \r\n| modified_at | Date | The date this presentation was modified. | \r\n\r\nPresentation models have the following properties:\r\n\r\n\r\n*Date.*\r\n\r\n### REST API\r\n\r\nGeneral:\r\n\r\n1. All requests after the initial authentication should be authenticated with a JWT with the `Authorization` header:\r\n\r\n\t```\r\n\tAuthorization: Bearer _insert_JWT_here_\r\n\t```\r\n1. All responses include the object in question *un-nested*. That is, if you're GETting a /groups/1, the group object will be in the root JSON response, and not under a \"group\" key.\r\n\r\n#### Auth\r\n\r\nOpenNotes uses JSON Web Tokens (JWT) for authentication.\r\n\r\n| path | description | params |\r\n|---|---|\r\n| POST *auth* | Registers a user and returns a JWT. | email, password, password_confirmation|\r\n| PATCH *auth* | Updates a user's password. | email, password, password_confirmation, current_password| \r\n| POST *auth/sign_in* | Authenticates a user and returns a JWT. | email, password| \r\n\r\n#### Users\r\n\r\n| path | description | params | sample response|\r\n|---|---|\r\n| GET /users/me | Returns the current user as well as all the user's notes, groups, and presentations. | | {\"email\" : \"user@email.com\", \"notes\": [], \"groups\": [], \"presentations\": [] } | \r\n\r\n#### Groups\r\n\r\n| path | description | params |\r\n|---|---|\r\n| GET /groups | Gets all groups for current user. | | \r\n| GET /groups/:id | Gets a particular group. | |\r\n| POST /groups | Creates a new group. | |\r\n| PATCH /groups/:id | Updates a group. | |\r\n| DELETE /groups/:id | Deletes a group. | |\r\n| POST /groups/:id/presentation | Associates a presentation object with this group. Groups typically live on the root_path. | |\r\n| PATCH /groups/:id/presentation | Updates the group's presentation. | |\r\n| DELETE /groups/:id/presentation | Deletes the group's presentation. | |\r\n\r\n\r\n#### Notes\r\n\r\n| path | description | params |\r\n|---|---|\r\n| GET /notes | Gets all notes for current user. | `modified_after`: Optional. Return only notes modified after a certain date.| \r\n| GET /notes/:id | Gets a particular note. | |\r\n| POST /notes | Creates a new note. | |\r\n| PATCH /notes/:id | Updates a note. | |\r\n| DELETE /notes/:id | Deletes a note. | |\r\n| POST /notes/:id/presentation | Associates a presentation object with this note. Notes presented outside the context of a group typically live on the root_path, and can either be a parameterization of the note title, or a random token. | |\r\n| PATCH /notes/:id/presentation | Updates the note's presentation. | |\r\n| DELETE /notes/:id/presentation | Deletes the note's presentation. | |\r\n\r\n\r\n#### Presentations\r\n\r\n| path | description | params |\r\n|---|---|\r\n| GET /presentations/:root_path/:relative_path | Returns the presentation and the associated object (group or note) at the `root_path` and `relative_path`. `relative_path` is optional. | | \r\n\r\n\r\n### Import/Export\r\n\r\nThe export file is a JSON file that follows a standard format, and is unencrypted.\r\n\r\n**Export file format:**\r\n\r\n```\r\n{\r\n\t\"groups\": [\r\n\t\t{\r\n\t\t\t\"id\": \"\",\r\n\t\t\t\"uuid\": \"\",\r\n\t\t\t\"name\": \"\",\r\n\t\t\t\"created_at\": \"\",\r\n\t\t\t\"modified_at\": \"\"\r\n\t\t}\r\n\t],\r\n\t\"notes\": [\r\n\t\t{\r\n\t\t\t\"id\": \"\",\r\n\t\t\t\"uuid\" : \"\",\r\n\t\t\t\"content\": \"\",\r\n\t\t\t\"group_id\": \"\",\r\n\t\t\t\"created_at\": \"\",\r\n\t\t\t\"modified_at\": \"\"\r\n\t\t}\r\n\t],\r\n\t\"presentations\": [\r\n\t\t{\r\n\t\t\t\"id\": \"\",\r\n\t\t\t\"uuid\": \"\",\t\t\t\r\n\t\t\t\"root_path\": \"\",\t\t\t\r\n\t\t\t\"relative_path\": \t\"\",\r\n\t\t\t\"presentable_id\" : \"\",\r\n\t\t\t\"presentable_type\" : \"\",\r\n\t\t\t\"created_at\": \"\",\r\n\t\t\t\"modified_at\": \"\"\r\n\t\t}\r\n\t]\r\n}\r\n```\r\n\r\nHigh-level flow, user wants to switch clients and servers:\r\n\r\n1. User chooses \"Export\" option on client A, which is paired with server A.\r\n2. Client produces JSON file with all notes unencrypted.\r\n3. User uploads JSON file to client B.\r\n4. Client B iterates over notes and encrypts the content of each of them locally.\r\n5. Client B sends updated JSON (with encrypted note content) data to server B.\r\n\r\n| path | description | params |\r\n|---|---|\r\n| POST /import | Imports JSON data. The server must preserve the relationships between groups, notes, and presentations. See {link} for a reference implementation. | data (the JSON data as specified above) | \r\n\r\n### Encryption\r\n\r\nEncryption and security should always be top of mind with OpenNotes. \r\n\r\nIt is important that there exist a seperation of concerns between the server and the client. That is, the client should not trust the server, and vice versa. Encryption keys are generated by stretching the user's input password using PBKDF2. The resulting 512 bit key is then split in two - the first half is sent to the server as the user's password, and the second half is saved locally as the user's master encryption key. This way, the server can never calculate the encryption key.\r\n\r\nThe following are general requirements for clients and servers:\r\n\r\n1. Note `content` must be encrypted locally before being sent to server.\r\n2. Client-server connections must be made securely through SSL/TLS.\r\n3. Upon receiving data from client, servers should encrypt sensitive data once more before storing with a key only the server knows. The server should decrypt this data before sending back to client.\r\n\r\n#### User Password Encryption and Key Generation\r\n\r\n**Client-side:**\r\n\r\n1. User enters \"user inputted password\" (`uip`) into registration or login password field.\r\n2. Client manipulates `uip` before sending to server as `password`:\r\n\ta. Stretch `uip` using PBKDF2 with 3000 iterations, SHA512 as hashing algorithm, and user's email as salt.\r\n\tb. Split result from (a) in two halves: \r\n\t\t- First half will be the `password` sent to the server. \r\n\t\t- Second half will be the user's global encryption key (`gk`) (stored locally and never sent to server.)\r\n\r\n#### Note Encryption\r\n\r\n**Client-side:**\r\n\r\nA note is encrypted using a random key locally generated for each note.\r\n\r\nFor every note,\r\n\r\n**If note does not have an associated presentation:**\r\n\r\n1. Generate a random key `ek`. \r\n2. Encrypt `content` using AES with `ek` as the secret.\r\n3. Generate locally encrypted encryption key `loc_eek` by encrypting `ek` using AES and `gk` as the secret.\r\n3. Send `content` and `loc_eek` to the server. (Do not send `ek`, which can be used to decrypt the note.)\r\n\r\n**If note has presentation:**\r\n\r\n1. Send `content` in plain text to server.\r\n\r\nBy generating a unique key for every note, this allows for easier changing of a user's password — only the note's `ek` will have to be re-encrypted with the new `gk`, and not the entire contents of the note. For password change instructions, see {link}.\r\n\r\n**Server-side:**\r\n\r\nFor every received note:\r\n\r\n1. Encrypt `content` using server known key and store as `enc_content`. Decrypt before sending back to client as `content`.\r\n\r\n#### Sharing/publishing\r\n\r\nWhen a note is shared, it is accessible by the public. To share a note, you create a presentation object on the note.\r\n\r\nWhen presenting,\r\n\r\n1. For sharing a single note, the client must remove local encryption from the note.\r\n2. For sharing an entire group, the client must remove local encryption for all notes belonging to the group.\r\n\r\nWhen un-presenting,\r\n\r\n1. For un-presenting a single note, the client must encrypt the note **if** the note doesn't belong to a presented group.\r\n2. For un-presenting a group, the client must encrypt all notes belonging to this group, except for notes that are individually presented.",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}